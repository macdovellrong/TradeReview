# 项目需求文档 (Project Status)

## 1. 项目简介
本项目是一个K线回放复盘工具，支持多窗口、多周期K线同步回放，基于 Finplot 和 PyQt6 开发。

## 2. 核心功能
- [x] **数据处理**: 
    - [x] 导入CSV Tick数据并转存为高效的 Parquet 格式。
    - [x] 支持 UTC 到美东时间 (America/New_York) 的自动转换。
    - [x] **高性能 K 线合成引擎**:
        - [x] 实时 Resampling，支持 1m - 1M 任意周期。
        - [x] **NY Close 对齐**: 
            - 强制使用纽约墙上时间 (Wall Time) 进行 K 线切分，消除夏令时漂移影响。
            - 4H/日线等大周期自动对齐到 **17:00 ET (New York Close)**，符合主流交易习惯。
    - [x] **绘图与多窗口**:
        - [x] 支持最多 4 个子窗口，独立选择周期 (1m, 5m, 15m, 30m, 1h, 4h, 1D)。
    - [x] 灵活布局切换：网格 (2x2)、垂直堆叠、标签页 (Tabs)。
    - [x] X轴时间显示，支持拖拽与缩放。
    - [x] 图表缩放功能优化，当鼠标在轴上的时候，缩放当前轴，当鼠标在图表中的时候，缩放两个轴
- [x] **回放功能**:
    - [x] 全量加载模式与回放模式切换。
    - [x] 支持任意时间开始回放 (通过时间选择器)。
    - [x] 回放速度可调节 (1x - 1000x)。
    - [x] **进度条 (Progress Slider)**: 支持拖动快速跳转，播放时自动更新。
- [x] **指标系统**:
    - [x] 固定指标支持：EMA (20, 30, 40, 50, 60)，颜色：红、橙、黄、绿、蓝。
    - [x] 布林带 (20, 2)，颜色：白色。
    - [x] 使用原生 PyqtGraph 绘制，解决了与 Finplot 的冲突问题。
- [x] **交互优化**:
    - [x] 滚轮缩放：直接滚动缩放 X 轴，按住 **Ctrl** 滚动缩放 Y 轴。
    - [x] **Reset View**: 一键还原视图，自动对齐数据边界。
    - [x] 手动加载数据：支持通过文件对话框选择 Parquet 数据。
    - [x] **十字光标同步**: 多窗口间时间轴同步显示。
    - [x] **无限缩放与平移**: 解除视图边界限制，支持查看未来/历史推算时间。
    - [x] **X轴优化**: 强制整数刻度步长（对齐K线），支持未来时间推算显示。
    - [x] **智能回放跟随**: 仅在K线增加时自动平移视图，允许回放时自由查看历史。
    - [x] **右键同步中心 (Sync Time Center)**:
        - [x] 图表右键菜单增加 "Sync Time Center" 选项。
        - [x] 点击后，所有图表窗口将平移视图，使该时间点位于屏幕正中央。
    - [x] **右键跳转回放 (Set Replay Start)**:
        - [x] 图表右键菜单增加 "Set Replay Start" 选项。
        - [x] 点击后，回放进度会自动跳转到选中的时间点。
        - [x] 若当前未开启回放模式，会自动勾选开启，并更新所有图表。
    - [x] **多窗口分离 (Pop-out)**:
        - [x] 每个图表窗口支持独立弹出 ("Pop" 按钮)。
        - [x] 弹出窗口支持多屏显示，关闭后自动还原回主窗口。
        - [x] 弹出状态下保持数据同步与交互功能。

## 3. 技术栈
- 前端：Finplot, PyQt6, PyqtGraph
- 后端：Pandas, Numpy
- 存储：Parquet (pyarrow)

## 4. 目录结构
- `/ui`: 包含主窗口及图表组件代码。
- `/engine`: 核心数据处理与指标计算引擎。
- `/tools`: 数据转换与检查工具。
- `/data`: 存放 Parquet 及 CSV 数据 (已加入 .gitignore)。
- `run.py`: 项目入口。